<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Career Partner - Agent Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #2980b9;
        }

        textarea,
        input {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }

        #chat-box {
            height: 300px;
            border: 1px solid #ddd;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background: #fafafa;
        }

        .msg {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }

        .msg.user {
            background: #e3f2fd;
            text-align: right;
            margin-left: 20%;
        }

        .msg.agent {
            background: #fff3e0;
            margin-right: 20%;
        }
    </style>
</head>

<body>
    <h1>AI Career Partner - Agent Console</h1>

    <div class="container">
        <!-- Market Trends Agent -->
        <div class="card">
            <h2>üìà Market Trends Agent</h2>
            <p>Analyze job demand for skills (Live Search).</p>
            <input type="text" id="trends-input" placeholder="Enter skills (comma separated), e.g., Python, React">
            <button onclick="checkTrends()">Analyze Market</button>
            <pre id="trends-output">Results will appear here...</pre>
        </div>

        <!-- GraphRAG Agent -->
        <div class="card">
            <h2>üï∏Ô∏è GraphRAG Agent</h2>
            <p>Discover related skills via Knowledge Graph.</p>
            <input type="text" id="graph-input" placeholder="Enter a skill, e.g., Python">
            <button onclick="checkGraph()">Find Related Skills</button>
            <pre id="graph-output">Results will appear here...</pre>
        </div>

        <!-- Interview Coach -->
        <div class="card" style="grid-column: span 2;">
            <h2>üé§ Interview Coach (WebSocket)</h2>
            <p>Real-time interview simulation.</p>
            <div id="chat-box"></div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="socket-input" placeholder="Type your answer...">
                <button onclick="sendMessage()">Send</button>
                <button onclick="connectSocket()" style="background: #27ae60;">Start Session</button>
            </div>
        </div>
    </div>

    <script>
        // --- Market Trends ---
        // Note: We need to expose this via API first. 
        // Since we only have agent functions, I'll simulate the API call structure 
        // assuming we might add a router for it, or I'll just explain this is a UI template.
        // WAIT: We don't have routers for Market/Graph yet in main.py? 
        // Let's check main.py... It has 'matcher', 'cv', 'interview'.

        // TO make this work nicely, I should probably add simple endpoints for these agents in main.py or a new router.
        // For now, I will just implement the Interview Socket part which is fully wired up.

        let ws = null;

        function connectSocket() {
            const sessionId = "demo-" + Math.random().toString(36).substr(2, 9);
            const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
            const wsUrl = `${protocol}//${window.location.host}/ws/interview/${sessionId}`;

            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                addMessage("System", "Connected to Interview Coach session: " + sessionId);
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                addMessage("Agent", data.text || data.message || JSON.stringify(data));
            };

            ws.onclose = () => addMessage("System", "Disconnected");
        }

        function sendMessage() {
            const input = document.getElementById('socket-input');
            const text = input.value;
            if (ws && text) {
                ws.send(text);
                addMessage("You", text);
                input.value = '';
            }
        }

        function addMessage(sender, text) {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = 'msg ' + (sender === 'You' ? 'user' : 'agent');
            div.innerHTML = `<strong>${sender}:</strong> ${text}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        async function checkTrends() {
            const input = document.getElementById('trends-input').value;
            const skills = input.split(',').map(s => s.trim()).filter(s => s);

            document.getElementById('trends-output').innerText = "Analyzing live specific data...";

            try {
                const response = await fetch('/agents/trends', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ skills: skills })
                });
                const data = await response.json();
                document.getElementById('trends-output').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                document.getElementById('trends-output').innerText = "Error: " + err.message;
            }
        }

        async function checkGraph() {
            const input = document.getElementById('graph-input').value;
            const skills = input.split(',').map(s => s.trim()).filter(s => s);

            document.getElementById('graph-output').innerText = "Querying Knowledge Graph...";

            try {
                const response = await fetch('/agents/graph', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ skills: skills })
                });
                const data = await response.json();
                document.getElementById('graph-output').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                document.getElementById('graph-output').innerText = "Error: " + err.message;
            }
        }
    </script>
</body>

</html>